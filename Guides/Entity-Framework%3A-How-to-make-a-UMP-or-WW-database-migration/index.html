<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Entity Framework%3A How to make a UMP or WW database migration - Internal Documentation</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Entity Framework%3A How to make a UMP or WW database migration";
        var mkdocs_page_input_path = "Guides\\Entity-Framework%3A-How-to-make-a-UMP-or-WW-database-migration.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Internal Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../about/">About</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Internal Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Entity Framework%3A How to make a UMP or WW database migration</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <p>The UMP project uses Entity Framework Core as its object-database mapper. In order to update the database you will need to add a new migration which provides the relevant instructions to upgrade the database from the previous version to the new one. The migration also contains instruction on how to downgrade from the new version to the previous one.</p>
<p>I will use the example of adding a new required boolean <code>isEnabled</code> column to the <code>OrgContact</code> table.</p>
<p>Follow these instructions to complete your first migration:</p>
<ul>
<li>
<p>Ensure you have the EF Core tools installed: <a href="https://docs.microsoft.com/en-us/ef/core/cli/dotnet#installing-the-tools">EF Core tools reference (.NET CLI) - EF Core</a></p>
</li>
<li>
<p>Edit the model you wish to update:</p>
</li>
<li>
<p>Within the <em>Database</em> project locate the <em>Models</em> folder and the <em>OrgContact</em> model: <code>Database/Models/OrgContact.cs</code></p>
</li>
<li>
<p>Add a field for the new column: <code>public bool OcIsEnabled { get; set; }</code></p>
<ul>
<li>This defines that the column should be of type bool (bit) and that it is required</li>
</ul>
</li>
<li>
<p>Add additional context:</p>
</li>
<li>
<p>In the same project find <em>DatabaseContext</em>: <code>Database/DatabaseContext.cs</code></p>
</li>
<li>Update the respective <code>modelBuilder.Entity&lt;&gt;()</code> call that defines how the model is mapped to the database table<ul>
<li>In this example the following would be added:</li>
</ul>
</li>
</ul>
<p><code>entity.Property(e =&gt; e.OcIsEnabled)
        .IsRequired()
        .HasColumnName("OC_IsEnabled")
        .HasDefaultValue(true);</code></p>
<ul>
<li>
<p>Add a new migration (<a href="https://docs.microsoft.com/en-us/ef/core/managing-schemas/migrations/managing?tabs=dotnet-core-cli">official documentation</a>):</p>
</li>
<li>
<p>Open the command line in Visual Studio: <em>Tools &gt; Command Line &gt; Developer Command Prompt</em></p>
</li>
<li>Run the following command: <code>dotnet ef migrations add &lt;NameOfMigration&gt; --project Database</code>, in this case <code>AddOcIsEnabled</code><ul>
<li>This should create a new file in the <em>Migrations</em> folder within the <em>Database</em> project named something like <code>XXXXXXXXXXXXXX_AddOcIsEnabled.cs</code></li>
</ul>
</li>
<li>The new file should contain two methods, <code>Up</code> and <code>Down</code> that are already populated with migration instructions.</li>
<li>
<p>To apply the migration run the following command in the same command prompt as previously: <code>dotnet ef database update --project Database</code></p>
<ul>
<li>Similarly to undo the migration run <code>dotnet ef database update &lt;NameOfPreviousMigration&gt; --project Database</code></li>
<li><strong>Note</strong>: the migration will also be applied automatically when the API is run locally</li>
</ul>
</li>
<li>
<p>Verify that the database has been updated in Microsoft SQL Server Management Studio</p>
</li>
</ul>
<p>To remove the last migration from the solution run the following:</p>
<ul>
<li>
<p><code>dotnet ef migrations remove --project Database</code></p>
</li>
<li>
<p>This should not be done after the migration has already been applied to the production database</p>
</li>
</ul>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
